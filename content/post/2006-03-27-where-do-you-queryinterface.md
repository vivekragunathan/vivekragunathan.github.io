---
title: Where do you QueryInterface ???
author: vivekragunathan
layout: post
date: 2006-03-27T00:23:00+00:00
url: /2006/03/27/where-do-you-queryinterface/
categories:
  - Uncategorized

---
For an ATL class, the QueryInterface is implemented in CComObject. The figure below is the inheritance hierarchy for a class generated by the wizard representing an ATL-COM object.

CComObjectRootBase has an InternalQueryInterface method, which uses the interface map built by the BEGIN\_COM\_MAP macro to resolve IID -> interface pointer. The BEGIN\_COM\_MAP macro also defines a method \_InternalQueryInterface, which passes the map on to InternalQueryInterface. CComObject implements QueryInterface, and calls \_InternalQueryInterface.

NOTE:  
CComObjectRootEx: Provides methods to handle object reference count management for both nonaggregated and aggregated objects.

CComObject: Implements IUnknown for a nonaggregated object. It is a template class that takes a class like CSomeClass derived from CComObjectRootEx.

CComObjectNoLock: Implements IUnknown for a nonaggregated object, but does not increment the module lock count in the constructor. ATL uses CComObjectNoLock internally for class factories.

CComCoClass: Defines the object&#8217;s default class factory and aggregation model.

[<img src="http://photos1.blogger.com/blogger/7911/970/320/COMClassHierarchy.jpg" alt="" border="0" />][1]

 [1]: http://photos1.blogger.com/blogger/7911/970/1600/COMClassHierarchy.jpg
