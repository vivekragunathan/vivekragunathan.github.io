<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en" >

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.126.1">

	<title>Quiz – Where am I ? &middot; A Developer&#39;s Experience</title>

	<meta name="description" content="" />

	

	<link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
	<link type="text/css" rel="stylesheet" href="/css/poole.css">
	<link type="text/css" rel="stylesheet" href="/css/hyde.css">

	
<style type="text/css">
  .sidebar {
    background-color: #347B98;
  }

  .read-more-link a {
    border-color: #347B98;
  }

  .pagination li a {
    color: #347B98;
    border: 1px solid #347B98;
  }

  .pagination li.active a {
    background-color: #347B98;
  }

  .pagination li a:hover {
    background-color: #347B98;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #347B98;
  }
</style>



	<link type="text/css" rel="stylesheet" href="/css/blockquote.css"><link type="text/css" rel="stylesheet" href="/css/custom.css">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

	<link rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
				integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
				crossorigin="anonymous" />

	<link rel="apple-touch-icon-precomposed"
				sizes="144x144"
				href="/images/apple-touch-icon-144-precomposed.png">

	<link rel="shortcut icon" href="/images/favicon.png">

	
	</head>

<body>
	<aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://stackoverflow.com/users/495612" rel="me" title="Stackoverflow" target="_blank">
        <i class="fab fa-stack-overflow" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/vivekragunathan" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/higherkindedtpe" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>

    <section class="blog-search-section">
      <div class="blog-search-box">
	
	<button class="blog-search-btn"><i class="fas fa-search"></i></button>
	<input type="text" class="blog-search-input" placeholder="Type to Search...">

	<form style='display: none;' action='/search/' method="get">
		<input name="q" type="text">
	</form>
</div>
    </section>
  </div>
</aside>


	<main class="content container">
		<div class="post">
  
  <div class="image featured ">
  	
	</div>

  <h1>Quiz – Where am I ?</h1>


  <div class="post-date">
    <time datetime="2011-02-19T12:05:38Z">Feb 19, 2011</time> &middot; 3 min read
  </div>

  <p>The question is, in C++, how do detect if an object is allocated on the stack or heap.</p>
<p>On Windows, the stack address is in the range of <code>0x80000000</code>. If the address of the variable is in this range, then you could say that the object is allocated on the stack; else it is allocated on the heap. This technique of detecting is not preferable since it may not work on other operating systems (such as linux), and deals with the platform specific information making it a non-portable solution.</p>
<p>Let us try to use standard C++ stuff to solve the problem. Ok, we want to know where an object is allocated. In C++, the <code>new</code> operator is responsible for allocating an object.</p>
<blockquote>
<p>It was very thoughtful of <a href="http://www2.research.att.com/~bs/homepage.html">Stroustoup</a> to keep the object allocation and initialization\construction separate. The <code>new</code> operator is responsible only for allocation. The compiler is responsible for weaving up the code for allocation and calling the constructor. It was also very thoughtful of being able to specify the location where the object needs to be allocated, which of course does not necessarily require overloading the <code>new</code> operator.</p>
</blockquote>
<p>C++ allows taking control of object allocation by overloading the <code>new</code> operator. By taking control, you would be able to detect where an object is allocated, and also keep a count of the objects allocated on the stack \ heap. The following code snippet illustrates the same:-</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">// SomeClass.h
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include &amp;lt;iostream&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include &amp;lt;stdlib.h&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include &amp;lt;deque&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include &amp;lt;algorithm&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> <span style="color:#ff79c6">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">SomeClass</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> std<span style="color:#ff79c6">::</span>deque<span style="color:#ff79c6">&amp;</span>lt;SomeClass<span style="color:#ff79c6">*&amp;</span>gt;      SomeClassDB;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> SomeClassDB<span style="color:#ff79c6">::</span>iterator    SomeClassDBIter;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> SomeClassDB<span style="color:#ff79c6">::</span>const_iterator SomeClassDBConstIter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">SomeClass</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> SomeClassDB heapObjects;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> SomeClassDB stackObjects;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">double</span> value;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">bool</span> isOnHeap;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> SomeClass(<span style="color:#8be9fd">double</span> d) <span style="color:#ff79c6">:</span> value(d), isOnHeap(SomeClass<span style="color:#ff79c6">::</span>IsOnHeap(<span style="color:#ff79c6">this</span>))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>IsOnHeap())
</span></span><span style="display:flex;"><span>           {
</span></span><span style="display:flex;"><span>              SomeClass<span style="color:#ff79c6">::</span>stackObjects.push_back(<span style="color:#ff79c6">this</span>);
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           PrintLocationInfo();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">~</span>SomeClass()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           SomeClassDBIter iter <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>find(SomeClass<span style="color:#ff79c6">::</span>heapObjects.begin(),
</span></span><span style="display:flex;"><span>                    SomeClass<span style="color:#ff79c6">::</span>heapObjects.end(),
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">this</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">if</span> (iter <span style="color:#ff79c6">!=</span> SomeClass<span style="color:#ff79c6">::</span>heapObjects.end())
</span></span><span style="display:flex;"><span>           {
</span></span><span style="display:flex;"><span>              SomeClass<span style="color:#ff79c6">::</span>heapObjects.erase(iter);
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">double</span> Value() <span style="color:#ff79c6">const</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&amp;</span>gt;value;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">bool</span> IsOnHeap() <span style="color:#ff79c6">const</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span><span style="color:#ff79c6">-&amp;</span>gt;isOnHeap;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">bool</span> IsOnStack() <span style="color:#ff79c6">const</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">!</span>IsOnHeap();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> std<span style="color:#ff79c6">::</span>string Location() <span style="color:#ff79c6">const</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> <span style="color:#50fa7b">IsOnHeap</span>() <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;Heap&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Stack&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">void</span> PrintLocationInfo() <span style="color:#ff79c6">const</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; Value() <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; <span style="color:#f1fa8c">&#34; is on &#34;</span> <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; Location().c_str() <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">bool</span> IsOnHeap(SomeClass<span style="color:#ff79c6">*</span> scPtr)
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span>            SomeClassDBConstIter iter <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>find(SomeClass<span style="color:#ff79c6">::</span>heapObjects.begin(), SomeClass<span style="color:#ff79c6">::</span>heapObjects.end(), scPtr);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> iter <span style="color:#ff79c6">!=</span> SomeClass<span style="color:#ff79c6">::</span>heapObjects.end();
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">bool</span> IsOnStack(SomeClass<span style="color:#ff79c6">*</span> scPtr)
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">!</span>IsOnHeap(scPtr);
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">void</span><span style="color:#ff79c6">*</span> <span style="color:#ff79c6">operator</span> <span style="color:#ff79c6">new</span>(size_t size)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           SomeClass<span style="color:#ff79c6">*</span> scPtr <span style="color:#ff79c6">=</span> (SomeClass<span style="color:#ff79c6">*</span>)malloc(size);
</span></span><span style="display:flex;"><span>           SomeClass<span style="color:#ff79c6">::</span>heapObjects.push_back(scPtr);
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> scPtr;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">void</span> <span style="color:#ff79c6">operator</span> <span style="color:#ff79c6">delete</span>(<span style="color:#8be9fd">void</span><span style="color:#ff79c6">*</span> ptr)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           free(ptr);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> size_t HeapCount()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> SomeClass<span style="color:#ff79c6">::</span>heapObjects.size();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> size_t StackCount()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           <span style="color:#ff79c6">return</span> SomeClass<span style="color:#ff79c6">::</span>stackObjects.size();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">void</span> PrintObjectCount()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>           std<span style="color:#ff79c6">::</span>cout <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; <span style="color:#f1fa8c">&#34;OnHeap: &#34;</span> <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; HeapCount() <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; <span style="color:#f1fa8c">&#34; .... OnStack: &#34;</span> <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; StackCount() <span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>lt; std<span style="color:#ff79c6">::</span>endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">// SomeClass.cpp
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">//
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&#34;SomeClass.h&#34;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span>SomeClassDB SomeClass<span style="color:#ff79c6">::</span>heapObjects;
</span></span><span style="display:flex;"><span>SomeClassDB SomeClass<span style="color:#ff79c6">::</span>stackObjects;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span> (<span style="color:#8be9fd">int</span> argc, <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   SomeClass sc(<span style="color:#bd93f9">0.123</span>);
</span></span><span style="display:flex;"><span>   SomeClass<span style="color:#ff79c6">*</span> scPtr <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> SomeClass(<span style="color:#bd93f9">1.234</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   SomeClass<span style="color:#ff79c6">::</span>PrintObjectCount();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      SomeClass sc1(<span style="color:#bd93f9">2.345</span>);
</span></span><span style="display:flex;"><span>      SomeClass<span style="color:#ff79c6">::</span>PrintObjectCount();
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">delete</span> scPtr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   SomeClass<span style="color:#ff79c6">::</span>PrintObjectCount();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You should be aware of implementing the custom <code>delete</code> if you have provided a custom <code>new</code> operator. It is logical because only a custom implementation that allocated memory for the object could possibly know how to deallocate. The above technique of overloading <code>new</code> \ <code>delete</code> is portable and safe since it is standard C++. As always, writing standard C++ is fun.</p>
<p>But why would one care to know where an object is allocated or keep a count of objects. I don’t think it would something you would require for production purposes. It could be for development\debugging purposes; maybe you want to detect memory leaks or a general distribution of objects. You could take control of the allocation by overloading <code>new</code> for a particular class; Or you can declare a global <code>new</code> operator to make it applicable for all classes.</p>

</div>


	</main>

	<footer>
  <div>
    &copy;  2024

    

    
  </div>
</footer>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
					integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
					crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap" />









	<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/js/search.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	

	<script>
	window.store = {
	  
	  
	}

	hljs.highlightAll();

	document
		.querySelector('.blog-search-input')
		.addEventListener('keyup', function (event) {
			event.preventDefault();

			if (event.keyCode === 13) {
				document.querySelector('.blog-search-box>form>input').value = 
					document.querySelector('.blog-search-input').value;

				document
					.querySelector('.blog-search-box>form')
					.submit(
);
			}
		});
	</script>

	
</body>

</html>
