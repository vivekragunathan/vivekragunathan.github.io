<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en" >

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.126.1">

	<title>Tree List View &middot; A Developer&#39;s Experience</title>

	<meta name="description" content="" />

	

	<link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
	<link type="text/css" rel="stylesheet" href="/css/poole.css">
	<link type="text/css" rel="stylesheet" href="/css/hyde.css">

	
<style type="text/css">
  .sidebar {
    background-color: #347B98;
  }

  .read-more-link a {
    border-color: #347B98;
  }

  .pagination li a {
    color: #347B98;
    border: 1px solid #347B98;
  }

  .pagination li.active a {
    background-color: #347B98;
  }

  .pagination li a:hover {
    background-color: #347B98;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #347B98;
  }
</style>



	<link type="text/css" rel="stylesheet" href="/css/blockquote.css"><link type="text/css" rel="stylesheet" href="/css/custom.css">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

	<link rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
				integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
				crossorigin="anonymous" />

	<link rel="apple-touch-icon-precomposed"
				sizes="144x144"
				href="/images/apple-touch-icon-144-precomposed.png">

	<link rel="shortcut icon" href="/images/favicon.png">

	
	</head>

<body>
	<aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://stackoverflow.com/users/495612" rel="me" title="Stackoverflow" target="_blank">
        <i class="fab fa-stack-overflow" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/vivekragunathan" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/higherkindedtpe" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>

    <section class="blog-search-section">
      <div class="blog-search-box">
	
	<button class="blog-search-btn"><i class="fas fa-search"></i></button>
	<input type="text" class="blog-search-input" placeholder="Type to Search...">

	<form style='display: none;' action='/search/' method="get">
		<input name="q" type="text">
	</form>
</div>
    </section>
  </div>
</aside>


	<main class="content container">
		<div class="post">
  
  <div class="image featured ">
  	
	</div>

  <h1>Tree List View</h1>


  <div class="post-date">
    <time datetime="2014-10-01T03:45:22Z">Oct 1, 2014</time> &middot; 5 min read
  </div>

  <blockquote>
<p>This article was published also on <a href="https://www.codeproject.com/Articles/825741/A-Simple-Tree-List-View">CodeProject.com</a>.</p>
</blockquote>
<h3 id="introduction">Introduction</h3>
<p><img src="tlv.png" alt="featured_image"></p>
<p>How about a control like that? Isn’t it cool? Unfortunately, you don’t get that with the Windows Forms controls collection. But you can get yourself one; read on.</p>
<p>We might have seen such types of controls and they are called by different names. In the context of the article (and in general I believe), such controls may be classified into two types. This categorization is primarily based on the functionality offered than the view itself. So the two types of the control are as follows:-</p>
<ul>
<li><strong>Tree List View (TLV)</strong> – A control like the conventional <code>ListView</code> (in its Details mode), which offers the facility of adding items as child to other items in the control so that a tree structure can be established. The items can be decorated with minor things like check boxes or images. This type of control does not offer the facility of in-place editing. That means it does not offer the facility of popping up a corresponding or associated control with each (sub)item for modifying the value associated with the (sub)item; if the control could be placed in edit mode.</li>
<li><strong>Tree Grid</strong> – I believe, by now, you would have understand what this type of control has to offer – everything that the Tree List View does and does not offer. You could compare a tree grid with a conventional data grid, in which elements could be added to establish a tree hierarchy.</li>
</ul>
<p>So that is a Tree List View control. Let us see how to build one.</p>
<h3 id="implementation-plan">Implementation Plan</h3>
<p>What we will be doing is derive from the existing <code>ListView</code> class, call it TreeListView. So our Tree List View is basically a control with all the capabilities of the list view and exactly same in its vanilla state. Not only that, we will have to capture the hierarchy information among the list view items. To do that, we will derive from the existing <code>ListViewItem</code> class, call it <code>ListViewItem2</code>. Assuming any instance of <code>ListViewItem2</code> to be a parent item (at any level), we should be able to add child list view items. In other words, an instance of ListViewItem2 is a container of its child items, and a cue for our custom rendering logic to render it as a hierarchy.</p>
<p>Thus the hierarchy is captured. Rest of it is rendering this hierarchy.</p>
<h3 id="taking-control-of-rendering">Taking Control Of Rendering</h3>
<p>Yes, we will have to take control of the painting logic for such a control. We will set the <code>OwnerDraw</code> to <code>true</code> and override <code>DrawItem</code> and <code>DrawSubItem</code> to implement the custom logic to render appropriately.</p>
<p>There are several things which are part of the rendering logic. Each item in the list view can have a checkbox or an image. We have to show\hide items depending on whether their parent is expanded or collapsed. Besides, it will also show a plus (+) image if it has child items and if it is expanded; or a minus (-) image if it has child items and if it is collapsed. An item with children should expand when clicked on the collapsed (+) image, and collapse when clicked on the expanded (-) minus image. And depending on the depth, the text for the first sub-item of each list view item must be spaced\tabbed accordingly. We should take care of auto adjusting the length of the header item when double clicked on the header seam lines. Our custom logic has to take care of all these things to render.</p>
<p>Code is worth a thousand words. Following is the meat of the rendering logic.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#ff79c6">void</span> OnDrawSubItem(<span style="color:#8be9fd">object</span> sender, DrawListViewSubItemEventArgs e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   SuspendLayout();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">var</span> lvItem = e.Item <span style="color:#ff79c6">as</span> ListViewItem2;
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">if</span> (lvItem == <span style="color:#ff79c6">null</span> || lvItem.IsEmpty)
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">var</span> txtMetrics = Helpers.GetTextMetrics(e.Graphics);      
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">int</span> yFactor = (e.Bounds.Height - txtMetrics.tmHeight) / <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">bool</span> hasChildren = lvItem.HasChildren;
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">int</span> xBound = e.Bounds.X + <span style="color:#bd93f9">5</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">if</span> (e.SubItem == e.Item.SubItems[<span style="color:#bd93f9">0</span>])
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd">int</span> iLevel = lvItem.GetIndentLevel();
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd">bool</span> hasParent = lvItem.Parent == <span style="color:#ff79c6">null</span> ? <span style="color:#ff79c6">false</span> : <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>      xBound += hasParent ? iLevel * <span style="color:#bd93f9">14</span> : <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (hasChildren)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>         <span style="color:#8be9fd">var</span> imageLocation = <span style="color:#ff79c6">new</span> Point(xBound, e.Bounds.Y + yFactor + <span style="color:#bd93f9">1</span>);
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>         lvItem.PlusMinusLocation = imageLocation;
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>         <span style="color:#8be9fd">var</span> image = 
</span></span><span style="display:flex;"><span>         		lvItem.Expanded 
</span></span><span style="display:flex;"><span>         		? TreeListView.MinusImage 
</span></span><span style="display:flex;"><span>         		: TreeListView.PlusImage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>         e.Graphics.DrawImage(image, imageLocation);
</span></span><span style="display:flex;"><span>         xBound += (TreeListView.PlusImage.Width + TreeListView.GeneralGapWidth);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">this</span>.CheckBoxes)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>				Size cbSize = CalculateCheckBoxSize(e.SubItem);
</span></span><span style="display:flex;"><span>				Rectangle cbBounds = <span style="color:#ff79c6">new</span> Rectangle(<span style="color:#ff79c6">new</span> Point(xBound, e.Bounds.Y), cbSize);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				ControlPaint.DrawCheckBox(
</span></span><span style="display:flex;"><span>					e.Graphics,
</span></span><span style="display:flex;"><span>					cbBounds,
</span></span><span style="display:flex;"><span>					(lvItem.Checked ? ButtonState.Checked : ButtonState.Normal) | ButtonState.Flat
</span></span><span style="display:flex;"><span>				);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>         lvItem.CheckBoxBounds = cbBounds;
</span></span><span style="display:flex;"><span>         xBound += cbBounds.Width + TreeListView.GeneralGapWidth;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">this</span>.SmallImageList != <span style="color:#ff79c6">null</span>
</span></span><span style="display:flex;"><span>	      		&amp;&amp; e.Item.ImageIndex &gt;= <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>	      		&amp;&amp; e.Item.ImageIndex &lt; <span style="color:#ff79c6">this</span>.SmallImageList.Images.Count)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        Image img = e.Item.ImageList.Images[e.Item.ImageIndex];
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> imageWidth = img.Width;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> imageHeight = img.Height - <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        e.Graphics.DrawImage(img, <span style="color:#ff79c6">new</span> Rectangle(xBound, e.Bounds.Y + <span style="color:#bd93f9">1</span>, imageWidth, imageHeight));
</span></span><span style="display:flex;"><span>        xBound += imageWidth + TreeListView.GeneralGapWidth;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	PointF drawPoint = <span style="color:#ff79c6">new</span> PointF(xBound, e.Bounds.Y + yFactor);
</span></span><span style="display:flex;"><span>	SizeF drawBound = <span style="color:#ff79c6">new</span> SizeF(e.Bounds.X + e.Bounds.Width - xBound, e.Bounds.Height);
</span></span><span style="display:flex;"><span>	RectangleF drawRect = <span style="color:#ff79c6">new</span> RectangleF(drawPoint, drawBound);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	StringFormat txtFormat = <span style="color:#ff79c6">new</span> StringFormat();
</span></span><span style="display:flex;"><span>	txtFormat.Trimming = StringTrimming.EllipsisCharacter;
</span></span><span style="display:flex;"><span>	txtFormat.LineAlignment = ToStringAlignment(e.Header.TextAlign);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  e.Graphics.DrawString(
</span></span><span style="display:flex;"><span>			e.SubItem.Text,
</span></span><span style="display:flex;"><span>      e.Item.Font,
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">new</span> SolidBrush(e.Item.ForeColor),
</span></span><span style="display:flex;"><span>      drawRect,
</span></span><span style="display:flex;"><span>      txtFormat
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>	ResumeLayout(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>That is it. We got our control working.</p>
<h3 id="points-of-interest">Points Of Interest</h3>
<ul>
<li>This control will work its magic only in the Details view and when the OwnerDraw is set to true. Otherwise, it is nothing more than a normal <code>ListView</code>. So, for instance, you could switch off the OwnerDraw and show the items flattened out; which was needed in my case then.</li>
<li>As of this writing, column re-ordering is not supported but it is possible to support column re-ordering.</li>
<li>As of this writing, column resizing is not supported. The column width is sized to fit the longest content. The resizing can be enabled from code by modifying the <strong><code>OnColumnWidthChanging</code></strong> event handler. However, the ‘size to fit content’ resizing (double clicking on the column header border) can not be achieved because the control fires the ColumnWidthChanging event both when resizing by dragging the column header or double clicking the column header border. Since the distinction cannot be made, it is not possible to programmatically set the column width.</li>
</ul>
<h3 id="history">History</h3>
<ul>
<li>Oct 1, 2014 – First Draft</li>
</ul>

</div>


	</main>

	<footer>
  <div>
    &copy;  2024

    

    
  </div>
</footer>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
					integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
					crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap" />









	<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/js/search.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	

	<script>
	window.store = {
	  
	  
	}

	hljs.highlightAll();

	document
		.querySelector('.blog-search-input')
		.addEventListener('keyup', function (event) {
			event.preventDefault();

			if (event.keyCode === 13) {
				document.querySelector('.blog-search-box>form>input').value = 
					document.querySelector('.blog-search-input').value;

				document
					.querySelector('.blog-search-box>form')
					.submit(
);
			}
		});
	</script>

	
</body>

</html>
