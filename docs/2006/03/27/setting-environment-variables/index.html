<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.78.2" />

  <title>Setting Environment Variables !!! &middot; A Developer&#39;s Experience</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="Setting Environment Variables !!!">
<meta itemprop="description" content="Need to change or set the value of an environment variable programmatically and without the need to restart/log off the machine.">
<meta itemprop="datePublished" content="2006-03-27T00:11:00+00:00" />
<meta itemprop="dateModified" content="2006-03-27T00:11:00+00:00" />
<meta itemprop="wordCount" content="353">



<meta itemprop="keywords" content="" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Setting Environment Variables !!!"/>
<meta name="twitter:description" content="Need to change or set the value of an environment variable programmatically and without the need to restart/log off the machine."/>


<meta property="og:title" content="Setting Environment Variables !!!" />
<meta property="og:description" content="Need to change or set the value of an environment variable programmatically and without the need to restart/log off the machine." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2006/03/27/setting-environment-variables/" />
<meta property="article:published_time" content="2006-03-27T00:11:00+00:00" />
<meta property="article:modified_time" content="2006-03-27T00:11:00+00:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  <link type="text/css" rel="stylesheet" href="/css/custom.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/images/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="#" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <div class="image featured">
  	
	</div>

  <h1>Setting Environment Variables !!!</h1>


  <div class="post-date">
    <time datetime="2006-03-27T00:11:00Z">Mar 27, 2006</time> &middot; 2 min read
  </div>

  <p>Need to change or set the value of an environment variable programmatically and without the need to restart/log off the machine. I need the change to reflect for all processes, ie, I need to change the global environment value and not the one in the PEB [Process Environment Block] of a process. Frustated with setting the value of an environment variable !!!</p>
<p>For getting the set of environment variables or to get the value of an environment vaible from your C# program, there is the GetEnvironmentVariables/GetEnvironmentVariable API in the System.Environment class. But there is no API for setting the value of an environment variable.</p>
<p>The system environment variables are stored in the registry under HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment.</p>
<p>The [current] user environment variables are stored in the registry under HKEY_CURRENT_USERE\Environment.</p>
<p>When the system boots up, the environment is built from this list in the registry. If we change the value directly in the registry, the change does not effect. For example, change the value of TEMP variable that specifies the temporary files directory, in the registry and check with the set command in the command prompt, you won’t see the change you made. Or just create a new entry in the registry under the one of the above mentioned registry paths, you won’t see the change. Also you can verify that programmatically with GetEnvironmentVariable API.</p>
<p>But the changes you made will be reflected after a log off or restart. After some research, I found the Win32 SDK API SetEnvironmentVariable. But unfortunately, it just the changes the variable value in the PEB of that process alone, it does not effect the global environment values. Pathetic.</p>
<p>There is definitely a solution for this simple and primary problem. All we have to do is to update the registry as we discussed before, and also notify that the global enviroment variable list has been modified. Ok, how do we do that ?</p>
<p>Simple, one line of code.</p>
<p><span style="font-family:courier new;">// Broadcast the WM_SETTINGCHANGE message for Enviroment</span></p>
<p><span style="font-family:courier new;">SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0,</span><br>
<span style="font-family:courier new;">(LPARAM) “Environment”,</span><br>
<span style="font-family:courier new;">SMTO_ABORTIFHUNG,</span><br>
<span style="font-family:courier new;">5000, &amp;dwReturnValue);</p></p>
<p>
  </span>Of course, this is C++ code. Not a big deal to do that in C# or whatever.
</p>

</div>


  </main>

  <footer>
  <div>
    &copy;  2021

    &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap">

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/ocean.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/scala.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/fsharp.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  
</body>
</html>
