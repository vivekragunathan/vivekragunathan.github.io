<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en" >

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.134.2">

	<title>Defining sum types across files &middot; A Developer&#39;s Experience</title>

	<meta name="description" content="" />

	

	<link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
	<link type="text/css" rel="stylesheet" href="/css/poole.css">
	<link type="text/css" rel="stylesheet" href="/css/hyde.css">

	
<style type="text/css">
  .sidebar {
    background-color: #347B98;
  }

  .read-more-link a {
    border-color: #347B98;
  }

  .pagination li a {
    color: #347B98;
    border: 1px solid #347B98;
  }

  .pagination li.active a {
    background-color: #347B98;
  }

  .pagination li a:hover {
    background-color: #347B98;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #347B98;
  }
</style>



	<link type="text/css" rel="stylesheet" href="/css/blockquote.css"><link type="text/css" rel="stylesheet" href="/css/custom.css">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

	<link rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
				integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
				crossorigin="anonymous" />

	<link rel="apple-touch-icon-precomposed"
				sizes="144x144"
				href="/images/apple-touch-icon-144-precomposed.png">

	<link rel="shortcut icon" href="/images/favicon.png">

	
	</head>

<body>
	<aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://stackoverflow.com/users/495612" rel="me" title="Stackoverflow" target="_blank">
        <i class="fab fa-stack-overflow" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/vivekragunathan" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/higherkindedtpe" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>

    <section class="blog-search-section">
      <div class="blog-search-box">
	
	<button class="blog-search-btn"><i class="fas fa-search"></i></button>
	<input type="text" class="blog-search-input" placeholder="Type to Search...">

	<form style='display: none;' action='/search/' method="get">
		<input name="q" type="text">
	</form>
</div>
    </section>
  </div>
</aside>


	<main class="content container">
		<div class="post">
  
  <div class="image featured ">
  	
	</div>

  <h1>Defining sum types across files</h1>


  <div class="post-date">
    <time datetime="2022-02-28T00:00:00Z">Feb 28, 2022</time> &middot; 4 min read
  </div>

  <p>Recently, I had to write an ADT. Interestingly, the sum types had quite a bit of logic in them - <code>implicit</code> definitions, type specific helpers and so on. Having them all in one file was a bit much; nothing but distraction to the reader.</p>
<p>Here is a contrived example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">ErrorType</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">None</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">BadRequest</span><span style="color:#ff79c6">(</span>field<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">NotFound</span><span style="color:#ff79c6">(</span>id<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Long</span><span style="color:#ff79c6">,</span> msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Unknown</span><span style="color:#ff79c6">(</span>msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BadRequest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// implicit definitions
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>		<span style="color:#6272a4">// BadRequest specific helpers
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">NotFound</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// implicit definitions
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>		<span style="color:#6272a4">// NotFound specific helpers
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">Unknown</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// implicit definitions
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>		<span style="color:#6272a4">// Unknown specific helpers
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>As I mentioned, each of the sum types  needed a companion object with <code>implicits</code> and helpers. I wouldn&rsquo;t mind having it all in <code>ErrorType.scala</code> if the it were only a couple of sum types.</p>
<p>In my case, even though the number of sum types was finite but definitely more than a handful. So, having all the companions with their big fat body in the same file was definitely not something I wanted to do. Also, I did not want to lose the power and guarantee of an ADT (<code>sealed trait</code>).</p>
<p>Note that you could have the companion object declarations in different files outside the file that defines the <code>sealed trait</code>. If you do, those definitions are not going to be considered as companion objetcts, which means that the compiler will not automatically use those definitions during an implicit lookup.</p>
<p>Fortunaely, there is a workaround, one that I learnt from <a href="https://users.scala-lang.org/u/balmungsan/summary">BalsungSan</a> in the Scala Discord <a href="https://discord.com/invite/scala">Channel</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// ErrorType.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">package</span> domain.errors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">trait</span> <span style="color:#50fa7b">ErrorType</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">BadRequest</span><span style="color:#ff79c6">(</span>field<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">NotFound</span><span style="color:#ff79c6">(</span>id<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Long</span><span style="color:#ff79c6">,</span> msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Unknown</span><span style="color:#ff79c6">(</span>msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BadRequest</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">BadRequestCompanion</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">NotFound</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">NotFoundCompanion</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">object</span> <span style="color:#50fa7b">Unknown</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">UnknownCompanion</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// BadRequest.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">package</span> domain.errors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">errors</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">BadRequestCompanion</span> <span style="color:#ff79c6">{</span> self<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">BadRequest.</span><span style="color:#ff79c6">type</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#6272a4">// implicit and helpers, a bunch
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// NotFound.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">package</span> domain.errors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">errors</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">NotFoundCompanion</span> <span style="color:#ff79c6">{</span> self<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">NotFound.</span><span style="color:#ff79c6">type</span> <span style="color:#ff79c6">=&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// implicit and helpers, a bunch
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// . . . and so on in other files, you get the idea
</span></span></span></code></pre></div><p>So, you see what is going on. It is a workaround but clever. It works well and covers all bases.</p>
<ul>
<li>The sum type guarantee is not broken. The base <code>sealed trait</code> can be extended only in <code>ErrorType.scala</code></li>
<li>Scala compiler is able to recognize the companions as they are. They are not namesakes.</li>
<li>The helper <code>XXXXCompanion</code> traits can be only be extended by respective sum type companion objects and not by any other type. This is a wonderful compile-time gurantee.</li>
<li>The helpers are contained within the subpackage <code>domain.errors</code> and cannot be used elsewhere. So, it is an implementation detail.</li>
<li>ADT defintion in <code>ErrorType.scala</code> is succinct and comprehensible to the reader.</li>
</ul>
<p>Yes, I called it a workaround. Because the inability to define sum types across files is not exclusive to the problem at hand. I am not a compiler writer / expert but here is an imaginary version <strong>if</strong> / <em>when</em> Scala decides to support it firsthand.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// ErrorType.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">package</span> domain.errors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">trait</span> <span style="color:#50fa7b">ErrorType</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">BadRequest</span><span style="color:#ff79c6">(</span>field<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">NotFound</span><span style="color:#ff79c6">(</span>id<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Long</span><span style="color:#ff79c6">,</span> msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">final</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Unknown</span><span style="color:#ff79c6">(</span>msg<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">ErrorType</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	partial <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BadRequest</span>
</span></span><span style="display:flex;"><span>	partial <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">NotFound</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span> <span style="color:#ff79c6">.</span>
</span></span><span style="display:flex;"><span>	partial <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">Unknown</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// BadRequest.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">package</span> domain.errors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>partial <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">BadRequest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// implicit and helpers, a bunch
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// NotFound.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>partial <span style="color:#ff79c6">object</span> <span style="color:#50fa7b">NotFound</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// implicit and helpers, a bunch
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// . . . and so on for other companions
</span></span></span></code></pre></div><p>Taking the C#&rsquo;s <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/partial-classes-and-methods"><strong>partial</strong></a> keyword as inspiration, we are instructing the compiler that the definition / body of the type may be defined in constituents across files. This also gets rid of the noise / ceremony - <code>private[errors]</code>, self type etc.</p>
<p>Note, for our problem at hand, the <code>partial</code> keyword is applied only to the companion, not to the definition of the sum type (<code>case class</code>). I am not sure if marking the <code>partial case class</code> would work because it would break the guarantee or contradict with the <code>sealed trait</code> tenet. Some food for thought if Scala compiler team were to ever consider this.</p>
<p>In general, if the Scala compiler were to provide the <code>partial</code> keyword, it could be applied to any type that will be defined across compilation units. This includes regular <code>classes</code> and other types alike. C# uses <code>partial</code> classes and methods for duming IDE generated code for user interfaces in XAML/WPF, which works really well.</p>
<p>While <code>partial</code> in Scala is a speck in the wishlist for the foreseeable future, the above workaround (companion helper trait) is no less. You could say our needs are <code>partial</code>ly served.</p>

</div>


	</main>

	<footer>
  <div>
    &copy;  2024

    

    
  </div>
</footer>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
					integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
					crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap" />









	<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/js/search.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	

	<script>
	window.store = {
	  
	  
	}

	hljs.highlightAll();

	document
		.querySelector('.blog-search-input')
		.addEventListener('keyup', function (event) {
			event.preventDefault();

			if (event.keyCode === 13) {
				document.querySelector('.blog-search-box>form>input').value = 
					document.querySelector('.blog-search-input').value;

				document
					.querySelector('.blog-search-box>form')
					.submit(
);
			}
		});
	</script>

	
</body>

</html>
