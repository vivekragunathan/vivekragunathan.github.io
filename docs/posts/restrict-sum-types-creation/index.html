<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en" >

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.126.1">

	<title>Restricting sum type instance creation &middot; A Developer&#39;s Experience</title>

	<meta name="description" content="" />

	

	<link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
	<link type="text/css" rel="stylesheet" href="/css/poole.css">
	<link type="text/css" rel="stylesheet" href="/css/hyde.css">

	
<style type="text/css">
  .sidebar {
    background-color: #347B98;
  }

  .read-more-link a {
    border-color: #347B98;
  }

  .pagination li a {
    color: #347B98;
    border: 1px solid #347B98;
  }

  .pagination li.active a {
    background-color: #347B98;
  }

  .pagination li a:hover {
    background-color: #347B98;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #347B98;
  }
</style>



	<link type="text/css" rel="stylesheet" href="/css/blockquote.css"><link type="text/css" rel="stylesheet" href="/css/custom.css">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

	<link rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
				integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
				crossorigin="anonymous" />

	<link rel="apple-touch-icon-precomposed"
				sizes="144x144"
				href="/images/apple-touch-icon-144-precomposed.png">

	<link rel="shortcut icon" href="/images/favicon.png">

	
	</head>

<body>
	<aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an Ã¼ber-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think Iâ€™ve seen something like this before â€“ John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://stackoverflow.com/users/495612" rel="me" title="Stackoverflow" target="_blank">
        <i class="fab fa-stack-overflow" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/vivekragunathan" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/higherkindedtpe" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>

    <section class="blog-search-section">
      <div class="blog-search-box">
	
	<button class="blog-search-btn"><i class="fas fa-search"></i></button>
	<input type="text" class="blog-search-input" placeholder="Type to Search...">

	<form style='display: none;' action='/search/' method="get">
		<input name="q" type="text">
	</form>
</div>
    </section>
  </div>
</aside>


	<main class="content container">
		<div class="post">
  
  <div class="image featured ">
  	
	</div>

  <h1>Restricting sum type instance creation</h1>


  <div class="post-date">
    <time datetime="2022-05-25T00:00:00Z">May 25, 2022</time> &middot; 2 min read
  </div>

  <p>I love ADTs and the compile time guarantee of exhaustiveness. Makes your business logic robust. Unfortunately, while the robustness pertains to the type, how do you ensure the guarantee also applies to the value held by instance of the type? In other words, we should prevent creating rogue instances of sum types with invalid values.</p>
<p>Consider the following ADT to understand how users have provided their names.  Ignore the logic behind determining how the different naming patterns are deduced. The <code>parse</code> method below is good enough to discuss the question in hand.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">Name</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">OnlyFirstName</span><span style="color:#ff79c6">(</span>value<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">FirstAndLastName</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    first<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    last<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">FullName</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    first<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    middle<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    last<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> parse<span style="color:#ff79c6">(</span>raw<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Validated</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Name</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">OnlyFirstName</span><span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">).</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">FirstAndLastName</span><span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">).</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">FullName</span><span style="color:#ff79c6">(</span>â€¦<span style="color:#ff79c6">).</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;â€¦&#34;</span><span style="color:#ff79c6">.</span>invalid
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>The definition is all good, provides the desired type robustness in narrowing down what exactly the user has provided as input. But there is a problem that the definition does not address.</p>
<p>It is still possible, anywhere in your application code, to create an instance of <code>OnlyFirstName</code> with a value that represents the full name. Might not be a big deal for user&rsquo;s name but I am sure you would agree you need such a guarantee for a real domain model in real time.</p>
<blockquote>
<p>Wouldn&rsquo;t you like to have the absolute guarantee that the sum types can and will be only created as part of its definition (file where your <code>sealed trait</code> is defined)? Especially as part of and after input validation.</p>
</blockquote>
<p>I bet you do. So, here is the trick to establish that guarantee:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#6272a4">// UserProvidedName.scala
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">trait</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">object</span> <span style="color:#50fa7b">Name</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">abstract</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">OnlyFirstName</span><span style="color:#ff79c6">(</span>value<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">abstract</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">FirstAndLastName</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    first<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    last<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">sealed</span> <span style="color:#ff79c6">abstract</span> <span style="color:#ff79c6">case</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">FullName</span><span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>    first<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    middle<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>    last<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">)</span> <span style="color:#ff79c6">extends</span> <span style="color:#50fa7b">Name</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">def</span> parse<span style="color:#ff79c6">(</span>raw<span style="color:#ff79c6">:</span> <span style="color:#8be9fd">String</span><span style="color:#ff79c6">)</span><span style="color:#ff79c6">:</span> <span style="color:#8be9fd">Validated</span><span style="color:#ff79c6">[</span><span style="color:#8be9fd">Name</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(...)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">OnlyFirstName</span><span style="color:#ff79c6">(...)</span> <span style="color:#ff79c6">{}.</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(...)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">FirstAndLastName</span><span style="color:#ff79c6">(...)</span> <span style="color:#ff79c6">{}).</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(...)</span> <span style="color:#ff79c6">new</span> <span style="color:#50fa7b">FullName</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{}.</span>valid
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;...&#34;</span><span style="color:#ff79c6">.</span>invalid
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><ul>
<li><code>abstract</code> - Prevent creating instances of the sum types; anonymous instances can still be created. See the <code>parse</code> method creating instances.</li>
<li><code>sealed</code> - Prevent extending the types elsewhere but this file</li>
<li><code>case class</code> - So that we can still pattern match sum types</li>
</ul>
<p>Thus, the only way to create an instance of the sum types is by calling the <code>parse</code> method while maintaining the guarantees of sum types. ðŸ’¥</p>

</div>


	</main>

	<footer>
  <div>
    &copy;  2024

    

    
  </div>
</footer>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
					integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
					crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap" />









	<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/js/search.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	

	<script>
	window.store = {
	  
	  
	}

	hljs.highlightAll();

	document
		.querySelector('.blog-search-input')
		.addEventListener('keyup', function (event) {
			event.preventDefault();

			if (event.keyCode === 13) {
				document.querySelector('.blog-search-box>form>input').value = 
					document.querySelector('.blog-search-input').value;

				document
					.querySelector('.blog-search-box>form')
					.submit(
);
			}
		});
	</script>

	
</body>

</html>
