<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.78.2" />

  <title>finally and Return Values !!! &middot; A Developer&#39;s Experience</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="finally and Return Values !!!">
<meta itemprop="description" content="Let us read some code:-
int SomeMethod() { int num = 1; try { num = 5; return num; } finally { num &#43;= 5; } }  What is the return value of SomeMethod?">
<meta itemprop="datePublished" content="2009-07-01T21:07:00+00:00" />
<meta itemprop="dateModified" content="2009-07-01T21:07:00+00:00" />
<meta itemprop="wordCount" content="383">



<meta itemprop="keywords" content="C#,codeproject,finally," />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="finally and Return Values !!!"/>
<meta name="twitter:description" content="Let us read some code:-
int SomeMethod() { int num = 1; try { num = 5; return num; } finally { num &#43;= 5; } }  What is the return value of SomeMethod?"/>


<meta property="og:title" content="finally and Return Values !!!" />
<meta property="og:description" content="Let us read some code:-
int SomeMethod() { int num = 1; try { num = 5; return num; } finally { num &#43;= 5; } }  What is the return value of SomeMethod?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2009/07/02/finally-and-return-values/" />
<meta property="article:published_time" content="2009-07-01T21:07:00+00:00" />
<meta property="article:modified_time" content="2009-07-01T21:07:00+00:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  <link type="text/css" rel="stylesheet" href="/css/custom.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/images/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="#" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <div class="image featured">
  	
	</div>

  <h1>finally and Return Values !!!</h1>


  <div class="post-date">
    <time datetime="2009-07-01T21:07:00Z">Jul 1, 2009</time> &middot; 2 min read
  </div>

  <DIV style="font-family:Tahoma;font-size:11pt;">
  Let us read some code:-</p>
  <pre class="brush: c-sharp;" style="font-family:Consolas;font-size:11pt;">int SomeMethod()
{
    int num = 1;

    try
    {
        num = 5;
        return num;
    }
    finally
    {
        num += 5;
    }
}</pre>
  <p>
    What is the return value of SomeMethod? Some anonymous guy asked that question in the code project forum, and it has been answered. I am writing about it here because it is interesting and subtle. One should not be surprised when people misinterpret finally. So let us take a guess, 10 (i = 5, then incremented by 5 in the finally block).It is not the right answer; rather SomeMethod returns 5. Agreed that finally is called in all cases of returning from SomeMethod but the return value is calculated when it is time to return from SomeMethod, normally or abnormally. The subtlety lies not in the way finally is executed but in the return value is calculated. So the return value (5) is decided when a return is encountered in the try block. The finally is just called for cleanup; and the num modified there is local to SomeMethod. So make the return value 10, it is no use being hasty making<br /> SomeMethod return from the finally block. Because returning from finally is not allowed. (We will talk about it later why returning from catch block is a bad practice<br /> and why can't we return from finally block). Had such modifications been done on a reference type, they would have been visible outside of SomeMethod, although the return value may be different. For instance,
  </p>
  <pre class="brush: c-sharp;" style="font-family:Consolas;font-size:11pt;">class Num
{
    public int _num = 0;
};

int SomeMethod()
{
    Num num = new Num();

    try
    {
        num._num = 5;
        return num._num;
    }
    finally
    {
        num._num += 5;
    }
}</pre>
  <p>
    So in the above case, the return value is still 5, but the Num._num would have been incremented to 10 when SomeMethod returns. So reflecting shows that our code is transformed as follows by the compiler, where the CS$1$0000 is our return value.
  </p>
  <pre class="brush: c-sharp;" style="font-family:Consolas;font-size:11pt;">private static int SomeMethod(Num num)
{
    int CS$1$0000;

    try
    {
        num._num = 5;
        CS$1$0000 = num._num;
    }
    finally
    {
        num._num += 5;
    }

    return CS$1$0000;
}</pre>
  <p>
    Given that we have clarified ourselves about finally, we should be writing the code as transformed by the compiler because returning from try and catch blocks is not a good practice.<br /> </DIV>
  </p>

</div>


  </main>

  <footer>
  <div>
    &copy;  2020

    &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap">

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/ocean.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/scala.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/fsharp.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  
</body>
</html>
