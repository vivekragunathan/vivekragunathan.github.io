<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en" >

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.135.0">

	<title>Offering __FILE__ and __LINE__ for C# !!! &middot; A Developer&#39;s Experience</title>

	<meta name="description" content="" />

	

	<link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
	<link type="text/css" rel="stylesheet" href="/css/poole.css">
	<link type="text/css" rel="stylesheet" href="/css/hyde.css">

	
<style type="text/css">
  .sidebar {
    background-color: #347B98;
  }

  .read-more-link a {
    border-color: #347B98;
  }

  .pagination li a {
    color: #347B98;
    border: 1px solid #347B98;
  }

  .pagination li.active a {
    background-color: #347B98;
  }

  .pagination li a:hover {
    background-color: #347B98;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #347B98;
  }
</style>



	<link type="text/css" rel="stylesheet" href="/css/blockquote.css"><link type="text/css" rel="stylesheet" href="/css/custom.css">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

	<link rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
				integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
				crossorigin="anonymous" />

	<link rel="apple-touch-icon-precomposed"
				sizes="144x144"
				href="/images/apple-touch-icon-144-precomposed.png">

	<link rel="shortcut icon" href="/images/favicon.png">

	
	</head>

<body>
	<aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="/">
            <img 
              src="/images/profile.png" 
              class="img-circle img-headshot center" 
              alt="Profile Picture">
          </a>
        </div>
        
      

      <h1>A Developer&#39;s Experience</h1>

      
      <p class="lead">The romantic image of an über-programmer is someone who fires up Emacs, types like a machine gun, and delivers a flawless final product from scratch. A more accurate image would be someone who stares quietly into space for a few minutes and then says Hmm. I think I’ve seen something like this before – John D. Cook</p>
      
    </div>

    <hr />

    <nav>
      <ul class="sidebar-nav">
        
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/pages">Pages</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/quotations">Qs</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://stackoverflow.com/users/495612" rel="me" title="Stackoverflow" target="_blank">
        <i class="fab fa-stack-overflow" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/vivekragunathan" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/higherkindedtpe" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>

    <section class="blog-search-section">
      <div class="blog-search-box">
	
	<button class="blog-search-btn"><i class="fas fa-search"></i></button>
	<input type="text" class="blog-search-input" placeholder="Type to Search...">

	<form style='display: none;' action='/search/' method="get">
		<input name="q" type="text">
	</form>
</div>
    </section>
  </div>
</aside>


	<main class="content container">
		<div class="post">
  
  <div class="image featured ">
  	
	</div>

  <h1>Offering __FILE__ and __LINE__ for C# !!!</h1>


  <div class="post-date">
    <time datetime="2012-09-08T18:30:40Z">Sep 8, 2012</time> &middot; 5 min read
  </div>

  <p>Not the same way but we could say better.</p>
<p>Visual Studio 2012, another power packed release of Visual Studio, among a lot of other powerful fancy language features, offers the ability to deduce the method caller details at compile time.</p>
<p>C++ offered the compiler defined macros FILE and LINE (and DATE and TIME), which are primarily intended for diagnostic purposes in a program, whereby the caller information is captured and logged. For instance, using LINE would be replaced with the exact line number in the file where this macro has been used. That sometimes beats the purpose and doesn’t gives us what we actually expect. Let’s see.</p>
<p>For instance, suppose you wish to write a verbose Log method with an idea to print rich diagnostic details, it would look something like this.</p>
<pre tabindex="0"><code>void LogException(
  const std::string&amp; logText,
  const std::string&amp; fileName,
  int lineNumber
)
{
   cout &lt;&lt; &#34;[&#34; &lt;&lt; fileName.c_str() &lt;&lt; &#34; (&#34; &lt;&lt; lineNumber &lt;&lt; &#34;)]: &#34; &lt;&lt; logText.c_str() &lt;&lt; std::endl;
}
</code></pre><p>Although it solves the purpose, it is not really developer friendly. You’ll have to explicitly pass the <code>__FILE__</code> and <code>__LINE__</code> parameters while calling the Log method. This results in these macros being scattered all over the files. What if there was a way to avoid passing these parameters explicitly. Yeah, you could make them default parameters – <code>const std::string&amp; fileName = __FILE__</code>, <code>int lineNumber = __LINE__</code>. However, the funny thing that happens is they are replaced with the line numbers of the parameters where they appear in the Log method declaration. Not only that, there is no macro for getting the method name. Any C++ developer would have experienced this difficulty.</p>
<p>C# does not offer the caller information facility directly but developers until now have been resorting to reflection. Although reflection help achieve what is required, it is not quite beautiful in the eyes of a developer. It requires a boring boiler plate code, and requires explicit use of some method call that deduces the caller information. Above all it is not something provided by the compiler itself for use during compile time, which means deducing the line number would not work, since reflection is totally a runtime thing. It also hurts performance (especially in the cases like logging).</p>
<p>Come Visual Studio 2012 (with C# 5.0), developers get the compile time facility to deduce caller information. This is different in two ways from what we have seen in C++. First, we are not going to use macros; we are going to use attributes. Second, we are going to do something at the place (in the method) where the caller information is required rather than at the place of method invocation as in C++. Let us see in action.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Runtime.CompilerServices;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Log(<span style="color:#8be9fd">string</span> logText,
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">        [CallerFileName]</span> <span style="color:#8be9fd">string</span> fileName = <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">        [CallerMemberName]</span> <span style="color:#8be9fd">string</span> methodName = <span style="color:#f1fa8c">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">        [CallerLineName]</span> <span style="color:#8be9fd">int</span> lineNumber = <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd">string</span> fmtLogText = <span style="color:#8be9fd">string</span>.Format(<span style="color:#f1fa8c">&#34;[{0} ({1})] {2}: {3}&#34;</span>,
</span></span><span style="display:flex;"><span>          fileName,
</span></span><span style="display:flex;"><span>          lineNumber,
</span></span><span style="display:flex;"><span>          methodName,
</span></span><span style="display:flex;"><span>          logText);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Trace.WriteLine(fmtLogText);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you see, there are CallerXXXName attributes that the parameters have been decorated with, and they are made optional arguments. The compiler sees these attributes, and identifies that the method expects the caller information and takes the responsibility of silently passing them itself. Since the parameters are made optional, you don’t have to explicitly mention the caller information in any way. The call sites thus are not littered with the caller information. It is transparent and clean. So, you would just say <code>Log(“some log message”)</code>, and the <code>Log</code> method gets the information of the calling method. As you see, the C# folks cleverly inverted the model used in C++. Besides, if you see that the caller method name attribute is named CallerMemberName. It is for a reason. Let us see it in the light of its application.</p>
<p>It is common that the caller information is employed for logging in most applications. But there is one other application of the caller information that I love, and solves the problem in an elegant way. It is in WPF for property changed event. Until before caller information attributes, this too was patched using reflection.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">SomeModel</span> : INotifyPropertyChanged
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// SomeModel ctor and other members</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#ff79c6">event</span> PropertyChangedEventHandler PropertyChanged;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">string</span> SomeProperty
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">get</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span>.someProperty;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">set</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>         <span style="color:#ff79c6">this</span>.someProperty = <span style="color:#ff79c6">value</span>;
</span></span><span style="display:flex;"><span>         NotifyPropertyChanged();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#ff79c6">void</span> NotifyPropertyChanged([CallerMemberName] String propertyWhichChanged  = <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (PropertyChanged != <span style="color:#ff79c6">null</span>)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>         PropertyChanged(<span style="color:#ff79c6">this</span>, <span style="color:#ff79c6">new</span> PropertyChangedEventArgs(propertyWhichChanged));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Caller could be a method, property or event. Hence the attribute has been named CallerMemberName. The compiler silently passes the property (caller) name at the place of invocation. The story does not end there. Although this feature has been introduced in C# 5.0/.NET 4.5, it supports multi-targeting too. That means when you use the C# 5.0 compiler for compiling against the older versions of the .NET framework, you can still make it work by defining the caller info attributes in the right namespace (<code>System.Runtime.CompilerServices</code>). The compiler expects the presence of the attributes and picks it up for processing by passing the caller information to the concerned method. Developers, happy?</p>
<p>There are other powerful features in C# 5.0 like async-await. However, the caller information attributes, despite being a miniature, holds its share.</p>

</div>


	</main>

	<footer>
  <div>
    &copy;  2024

    

    
  </div>
</footer>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
					integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
					crossorigin="anonymous"></script>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap" />









	<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/js/search.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	

	<script>
	window.store = {
	  
	  
	}

	hljs.highlightAll();

	document
		.querySelector('.blog-search-input')
		.addEventListener('keyup', function (event) {
			event.preventDefault();

			if (event.keyCode === 13) {
				document.querySelector('.blog-search-box>form>input').value = 
					document.querySelector('.blog-search-input').value;

				document
					.querySelector('.blog-search-box>form')
					.submit(
);
			}
		});
	</script>

	
</body>

</html>
